{% extends "base/base.html" %} {% block body %}

<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4">
  <a
    href="{% url 'home' %}"
    class="inline-flex items-center text-gray-400 hover:text-white"
  >
    <svg
      class="w-5 h-5 mr-2"
      fill="none"
      stroke="currentColor"
      viewBox="0 0 24 24"
    >
      <path
        stroke-linecap="round"
        stroke-linejoin="round"
        stroke-width="2"
        d="M10 19l-7-7m0 0l7-7m-7 7h18"
      ></path>
    </svg>
    Back to blog
  </a>
</div>

<!-- Main Content -->
<div
  class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8"
  x-data="{delete:false}"
>
  <div class="flex flex-col lg:flex-row gap-8">
    <!-- Article Content -->
    <article class="lg:w-3/4">
      <img
        src="https://placehold.co/800x400"
        alt="Blog post hero"
        class="w-full h-[400px] object-cover rounded-lg mb-8"
      />
      <div class="flex justify-between">
        <div>
          <h1 class="text-4xl font-bold mb-4">{{post.title}}</h1>
          <div class="flex items-center text-gray-400 mb-8">
            <span>{{post.created_at|date:"F d, Y"}}</span>
            <span class="mx-2">â€¢</span>
            <span>11 min read</span>
          </div>
        </div>
        {% if request.user == post.user %}
        <div>
          <button
            class="btn btn-error"
            hx-get="{% url 'delete_post' post.slug %}"
            hx-swap="innerHTML"
            hx-target="#delete"
            onclick="document.getElementById('overlay').classList.remove('hidden')"
          >
            Delete Article
          </button>
          <button
            class="btn btn-secondary"
            onclick="location.href='{% url 'edit_post' post.slug %}'"
          >
            Edit Article
          </button>
        </div>
        {% endif %}
      </div>
      <div class="prose prose-invert max-w-none">
        <p class="text-gray-300 mb-4">{{post.description}}</p>
        <h2 class="text-2xl font-semibold mt-8 mb-4">Key Features</h2>
        <p class="text-gray-300 mb-4">
          Duis aute irure dolor in reprehenderit in voluptate velit esse cillum
          dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non
          proident, sunt in culpa qui officia deserunt mollit anim id est
          laborum.
        </p>
        <ul class="list-disc list-inside text-gray-300 mb-4">
          <li>Feature one explanation</li>
          <li>Feature two explanation</li>
          <li>Feature three explanation</li>
        </ul>
      </div>
      <div>
        {% for tag in post.tags.all %}
        <span class="badge badge-accent">{{tag.tag}}</span>
        {% endfor %}
      </div>
      <div class="py-2 mt-4">
        <h2 class="text-2xl font-bold">Comments</h2>
        {% if user.is_authenticated %}

        <form hx-target="#comments" hx-swap="beforeend" method="post">
          {% csrf_token %}
          <div class="form-control flex-1">
            <label for="last-name" class="label">
              <span class="label-text">Comment</span>
            </label>
            {{form.comment}}
          </div>
          <div class="mt-4 text-right flex-1">
            <button type="submit" class="btn btn-primary">Post comment</button>
          </div>
        </form>
        <ul
          id="comments"
          class="timeline timeline-vertical timeline-start w-full left-0"
        >
          {% for comment in comments %}
          <li>
            {% if forloop.counter != 1 %}
            <hr />
            {% endif %}
            <div class="timeline-middle">
              <svg
                xmlns="http://www.w3.org/2000/svg"
                viewBox="0 0 20 20"
                fill="currentColor"
                class="h-5 w-5"
              >
                <path
                  fill-rule="evenodd"
                  d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.857-9.809a.75.75 0 00-1.214-.882l-3.483 4.79-1.88-1.88a.75.75 0 10-1.06 1.061l2.5 2.5a.75.75 0 001.137-.089l4-5.5z"
                  clip-rule="evenodd"
                />
              </svg>
            </div>
            <div class="timeline-end timeline-box">
              <div class="flex gap-2 items-center mb-3">
                <img
                class="w-12 h-12 rounded-full"
                  src="{{comment.user.image.url}}"
                  alt="{{comment.user.username}}"
                />
                <p>
                  <strong class="text-primary"
                    >{{comment.user.first_name}}
                    {{comment.user.last_name}}</strong
                  >
                </p>
              </div>
              <div class="ml-6">
                <p>{{ comment.comment }}</p>
                <p class="text-gray-500 text-sm">{{ comment.created_at }}</p>
              </div>
            </div>
            <hr />
          </li>
          {% empty %}
          <p class="text-base">No comments yet. Be the first to comment!</p>
          {% endfor %}
        </ul>
        {% else %}
        <div class="space-y-2">
          <p>You must be logged in to comment.</p>
          <button class="btn btn-primary" x-on:click="location.href='/login/'">
            Login
          </button>
        </div>

        {% endif %}
      </div>
    </article>

    <!-- Table of Contents Sidebar -->
    <aside class="lg:w-1/4">
      <div class="sticky top-4 bg-gray-800 rounded-lg p-6">
        <h2 class="text-lg font-semibold mb-4">Table of Contents</h2>
        <nav class="space-y-2">
          <a href="#" class="block text-gray-400 hover:text-white"
            >Introduction</a
          >
          <a href="#" class="block text-gray-400 hover:text-white"
            >Key Features</a
          >
          <a href="#" class="block text-gray-400 hover:text-white"
            >Implementation</a
          >
          <a href="#" class="block text-gray-400 hover:text-white"
            >Conclusion</a
          >
        </nav>
      </div>
    </aside>
  </div>
  <section
    id="overlay"
    class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"
  >
    <div class="modal-box max-w-3xl text-base">
      <div id="delete">
        <!-- HTMX will load modal content here -->
      </div>
      <div class="modal-action"></div>
    </div>
  </section>
</div>

{% endblock body %}
